<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAS - Agent Database</title>
    
    <script>
        const REQUIRED_LEVEL = 1;
    </script>
    <script src="security.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>

    <main class="terminal">
        
        <img src="logo-sas.png" alt="Logo SAS" class="logo">
        
        <h1>AGENT DATABASE<span class="blinker">_</span></h1>
        <p class="status">SYSTEM STATUS: <span class="secure">SECURED</span> :: ACCESS: <span class="restricted">[ENCRYPTED]</span></p>

        <ul class="agent-list" id="agent-list-container">
            <li>[CHARGEMENT DE LA BASE DE DONNÉES...]</li>
        </ul>

        <footer class="portal-footer">
            <a href="index.html" class="back-link">&lt;&lt; RETURN_TO_MAINFRAME</a>
        </footer>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const listContainer = document.getElementById('agent-list-container');

            try {
                // 1. On appelle notre "Cerveau" (l'API)
                const response = await fetch('/api/get-agents');
                const data = await response.json();

                // 2. On vérifie si l'API a renvoyé les agents
                if (data.agents && data.agents.length > 0) {
                    
                    let htmlToInsert = ''; // On prépare une chaîne de texte HTML

                    // 3. On boucle sur chaque agent reçu de la BDD
                    data.agents.forEach(agent => {
                        // On construit la ligne <li> en utilisant les données de la BDD
                        htmlToInsert += `
                            <li>
                                <a href="${agent.profile_url}" class="${agent.css_class || ''}">
                                    ${agent.status_text}
                                </a>
                            </li>
                        `;
                    });

                    // 4. On injecte tout le HTML d'un coup dans la page
                    listContainer.innerHTML = htmlToInsert;

                } else {
                    listContainer.innerHTML = '<li>Erreur: Aucun agent trouvé dans la base.</li>';
                }
            } catch (error) {
                console.error('Erreur lors de la récupération des agents:', error);
                listContainer.innerHTML = '<li>[ERREUR DE CONNEXION AU MAINFRAME]</li>';
            }
        });
    </script>
    </body>
</html>