<main class="terminal">
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const gridContainer = document.getElementById('operators-grid-container');
            
            const gravesBox = document.getElementById('agent-box-graves');
            const javierBox = document.getElementById('agent-box-javier');
            const jiBox = document.getElementById('agent-box-ji');

            try {
                const response = await fetch('/api/read?resource=agents');
                const data = await response.json();

                if (data.agents && data.agents.length > 0) {
                    
                    let gridHTML = '';
                    data.agents.sort((a, b) => a.id - b.id);

                    data.agents.forEach(agent => {
                        
                        // Nettoyer l'URL : utiliser '#' par défaut, et supprimer tout '/' au début
                        const cleanProfileUrl = (agent.profile_url || '#').replace(/^\//, '');
                    
                        if (agent.id === 1 || agent.id === 3 || agent.id === 18) {
                            let box;
                            if (agent.id === 1) box = gravesBox;
                            if (agent.id === 3) box = javierBox;
                            if (agent.id === 18) box = jiBox;
                            
                            box.querySelector('.name').textContent = agent.name;
                            // CORRECTION APPLIQUÉE : Utilisation du chemin relatif '../'
                            box.querySelector('a').href = `../${cleanProfileUrl}`; 
                            return;
                        }

                        
                        
                        const parts = agent.status_text.split('::').map(part => part.trim());
                        let buttonText = parts[1] || '[STATUS INCONNU]';
                        
                        if (buttonText === 'DOSSIER SCELLÉ') buttonText = 'DOSSIER SCELLÉ';
                        if (buttonText === 'STATUT NON-SANCTIONNÉ') buttonText = 'NON-SANCTIONNÉ';

                        let colorClass = 'status-gray';
                        if (agent.css_class === 'decrypted') {
                            colorClass = 'status-green';
                        } else if (agent.css_class === 'corrupted') {
                            colorClass = 'status-red';
                        }
                        
                        
                        gridHTML += `
                            <div class="chart-node team-member ${agent.css_class || ''}">
                                <div class="role">[AGENT_STD]</div>
                                <div class="name">${agent.name}</div>
                                <a href="../${cleanProfileUrl}" class="action-button ${colorClass}" data-id="${agent.id}">
                                    [${buttonText}]
                                </a>
                            </div>
                        `;
                    });

                    gridContainer.innerHTML = gridHTML;

                    

                } else {
                    gridContainer.innerHTML = '<p>[ERREUR: AUCUN AGENT TROUVÉ]</p>';
                }
            } catch (error) {
                console.error('Erreur lors de la récupération des agents:', error);
                gridContainer.innerHTML = '<p>[ERREUR DE CONNEXION AU MAINFRAME]</p>';
            }
        });
    </script>
</body>
</html>