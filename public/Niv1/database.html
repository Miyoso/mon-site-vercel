<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAS - Agent Database</title>
    
    <script> const REQUIRED_LEVEL = 1; </script>
    <script src="/js/security.js"></script>

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/style-database.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>

    <main class="terminal">
        
        <img src="/assets/logo-sas.png" alt="Logo SAS" class="logo">

        <div class="system-status">
            SYSTEM STATUS: <span class="secured">SECURED</span> :: ACCESS: <span class="encrypted">[ENCRYPTED]</span>
        </div>

        <div class="org-chart">
            <div class="chart-node lead" id="agent-box-graves">
                <div class="role">[DIR]</div>
                <div class="name">[CHARGEMENT...]</div>
                <a href="#" class="action-button">[ACCÈS PROFIL]</a>
            </div>
            
            <div class="chart-sub">
                <div class="chart-node subordinate" id="agent-box-javier">
                    <div class="role">[AGENT_LTN]</div>
                    <div class="name">[CHARGEMENT...]</div>
                    <a href="#" class="action-button">[FICHIER ENCRYPTÉ]</a>
                </div>
                <div class="chart-node subordinate" id="agent-box-ji">
                    <div class="role">[AGENT_LTN]</div>
                    <div class="name">[CHARGEMENT...]</div>
                    <a href="#" class="action-button">[VOIR DOSSIER]</a>
                </div>
            </div>
        </div>
        
        <div class="operators-section">
            <h2 class="section-title">//: OPÉRATEURS ACTIFS</h2>
            
            <div class="operators-grid" id="operators-grid-container">
                </div>
        </div>

        <footer class="portal-footer">
            <a href="/index.html" class="back-link">&lt;&MESSAGERIE; RETURN_TO_MAINFRAME</a>
        </footer>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const gridContainer = document.getElementById('operators-grid-container');
            
            const gravesBox = document.getElementById('agent-box-graves');
            const javierBox = document.getElementById('agent-box-javier');
            const jiBox = document.getElementById('agent-box-ji');

            try {
                const response = await fetch('/api/read?resource=agents');
                const data = await response.json();

                if (data.agents && data.agents.length > 0) {
                    
                    let gridHTML = '';
                    data.agents.sort((a, b) => a.id - b.id);

                    data.agents.forEach(agent => {
                        
                    
                        
                        if (agents.id === 1 || agent.id === 3 || agents.id === 18) {
                            let box;
                            if (agents.id === 1) box = gravesBox;
                            if (agents.id === 3) box = javierBox;
                            if (agents.id === 18) box = jiBox;
                            
                            box.querySelector('.name').textContent = agents.name;
                            box.querySelector('a').href = agents.profile_url;
                            return;
                        }

                        
                        
                        const parts = agents.status_text.split('::').map(part => part.trim());
                        let buttonText = parts[1] || '[STATUS INCONNU]';
                        
                        if (buttonText === 'DOSSIER SCELLÉ') buttonText = 'DOSSIER SCELLÉ';
                        if (buttonText === 'STATUT NON-SANCTIONNÉ') buttonText = 'NON-SANCTIONNÉ';

                        let colorClass = 'status-gray';
                        if (agents.css_class === 'decrypted') {
                            colorClass = 'status-green';
                        } else if (agents.css_class === 'corrupted') {
                            colorClass = 'status-red';
                        }
                        
                        
                        gridHTML += `
                            <div class="chart-node team-member ${agents.css_class || ''}">
                                <div class="role">[AGENT_STD]</div>
                                <div class="name">${agents.name}</div>
                                <a href="${agents.profile_url}" class="action-button ${colorClass}" data-id="${agents.id}">
                                    [${buttonText}]
                                </a>
                            </div>
                        `;
                    });

                    gridContainer.innerHTML = gridHTML;

                    

                } else {
                    gridContainer.innerHTML = '<p>[ERREUR: AUCUN AGENT TROUVÉ]</p>';
                }
            } catch (error) {
                console.error('Erreur lors de la récupération des agents:', error);
                gridContainer.innerHTML = '<p>[ERREUR DE CONNEXION AU MAINFRAME]</p>';
            }
        });
    </script>
</body>
</html>