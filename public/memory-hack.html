<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÉQUENCE MÉMOIRE // HACK NIV.5</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #050505;
            --terminal-green: #00ffcc;
            --terminal-dim: #005c4b;
            --terminal-red: #ff3333;
            --grid-bg: #0a0a0a;
        }

        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        body::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .hack-container {
            border: 2px solid var(--terminal-green);
            padding: 2rem;
            background: rgba(0, 15, 15, 0.95);
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.15);
            width: 500px;
            max-width: 95%;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        h1 {
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
            text-shadow: 0 0 10px var(--terminal-green);
            letter-spacing: 2px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--terminal-dim);
            padding-bottom: 10px;
            font-size: 0.9rem;
        }

        .grid-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px auto;
            width: 300px;
        }

        .pad-btn {
            height: 80px;
            border: 1px solid var(--terminal-dim);
            background: rgba(0, 20, 20, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.05s;
            color: var(--terminal-dim);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        }

        .pad-btn:active {
            transform: scale(0.95);
        }

        .pad-btn.active {
            background: var(--terminal-green);
            color: #000;
            box-shadow: 0 0 20px var(--terminal-green);
            border-color: #fff;
        }

        .pad-btn.error {
            background: var(--terminal-red);
            box-shadow: 0 0 20px var(--terminal-red);
            border-color: var(--terminal-red);
        }

        .message-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 20;
        }

        .message-overlay.visible { visibility: visible; opacity: 1; }
        .msg-success { color: var(--terminal-green); text-shadow: 0 0 20px var(--terminal-green); }
        .msg-fail { color: var(--terminal-red); text-shadow: 0 0 20px var(--terminal-red); }

        #start-btn {
            background: transparent;
            color: var(--terminal-green);
            border: 2px solid var(--terminal-green);
            padding: 10px 30px;
            font-family: inherit;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 10px;
        }
        #start-btn:hover { background: var(--terminal-green); color: #000; }
        
        #timer-display {
            font-weight: bold;
            color: var(--terminal-green);
            min-width: 60px;
            text-align: right;
        }
        #timer-display.urgent {
            color: var(--terminal-red);
            animation: pulse-red 0.5s infinite;
        }
        @keyframes pulse-red {
            0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; }
        }

    </style>
</head>
<body>

    <div class="hack-container">
        <h1>>> BYPASS MÉMOIRE <<</h1>
        
        <div class="status-bar">
            <span>SÉQUENCE: <span id="round-display">0/35</span></span>
            <span id="status-text">PRÊT...</span>
            <span>TEMPS: <span id="timer-display">10.0</span>s</span>
        </div>

        <div class="grid-pad" id="grid-pad"></div>

        <button id="start-btn" onclick="startGame()">LANCER L'INJECTION</button>

        <div id="overlay" class="message-overlay">
            <div id="overlay-msg"></div>
        </div>
    </div>

    <script>
        const config = {
            roundsToWin: 35,
            baseSpeed: 800,
            speedDecrement: 0,
            minSpeed: 200,
            gridSize: 9,
            timeLimit: 10.0 
        };

        let state = {
            sequence: [],
            playerInput: [],
            currentRound: 0,
            isPlayerTurn: false,
            isPlayingSequence: false,
            timerInterval: null
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const gridPad = document.getElementById('grid-pad');
        const roundDisplay = document.getElementById('round-display');
        const statusText = document.getElementById('status-text');
        const timerDisplay = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const overlay = document.getElementById('overlay');
        const overlayMsg = document.getElementById('overlay-msg');

        for (let i = 0; i < config.gridSize; i++) {
            let btn = document.createElement('div');
            btn.className = 'pad-btn';
            btn.dataset.index = i;
            btn.innerText = '0x' + (i + 1 + 9).toString(16).toUpperCase(); 
            btn.addEventListener('mousedown', () => handleInput(i));
            gridPad.appendChild(btn);
        }

        function playTone(freq, type='square', duration=0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function startGame() {
            state.sequence = [];
            state.playerInput = [];
            state.currentRound = 0;
            state.isPlayerTurn = false;
            startBtn.style.display = 'none';
            nextRound();
        }

        function startTimer() {
            let timeLeft = config.timeLimit;
            timerDisplay.textContent = timeLeft.toFixed(1);
            timerDisplay.classList.remove('urgent');

            if (state.timerInterval) clearInterval(state.timerInterval);

            state.timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                
                if (timeLeft <= 3.0) timerDisplay.classList.add('urgent');

                if (timeLeft <= 0) {
                    timeLeft = 0;
                    timerDisplay.textContent = "0.0";
                    clearInterval(state.timerInterval);
                    gameOver(true); 
                } else {
                    timerDisplay.textContent = timeLeft.toFixed(1);
                }
            }, 100);
        }

        function stopTimer() {
            if (state.timerInterval) clearInterval(state.timerInterval);
            timerDisplay.textContent = config.timeLimit.toFixed(1);
            timerDisplay.classList.remove('urgent');
        }

        function nextRound() {
            state.currentRound++;
            state.playerInput = [];
            state.isPlayerTurn = false;
            stopTimer();
            
            roundDisplay.innerText = `${state.currentRound}/${config.roundsToWin}`;
            statusText.innerText = "NOUVEAU MOTIF...";
            statusText.style.color = "#666";
            
            state.sequence = [];
            
          
            const longueurSequence = 5 + Math.floor(state.currentRound / 5);

            for (let k = 0; k < longueurSequence; k++) {
                state.sequence.push(Math.floor(Math.random() * config.gridSize));
            }

            setTimeout(() => playSequence(), 800);
        }

        function playSequence() {
            state.isPlayingSequence = true;
            let i = 0;
            
            const speed = Math.max(config.minSpeed, config.baseSpeed - (state.currentRound * config.speedDecrement));

            const interval = setInterval(() => {
                if (i >= state.sequence.length) {
                    clearInterval(interval);
                    state.isPlayingSequence = false;
                    state.isPlayerTurn = true;
                    statusText.innerText = "À VOUS !";
                    statusText.style.color = "var(--terminal-green)";
                    startTimer(); // Démarrage du timer ici
                    return;
                }
                flashButton(state.sequence[i], speed);
                i++;
            }, speed);
        }

        function flashButton(index, speed) {
            const btn = gridPad.children[index];
            btn.classList.add('active');
            playTone(300 + (index * 100), 'square', speed / 2000); 
            
            const flashDuration = Math.max(50, speed * 0.6); 
            
            setTimeout(() => {
                btn.classList.remove('active');
            }, flashDuration);
        }

        function handleInput(index) {
            if (!state.isPlayerTurn || state.isPlayingSequence) return;

            const btn = gridPad.children[index];
            btn.classList.add('active');
            playTone(300 + (index * 100), 'square', 0.1);
            setTimeout(() => btn.classList.remove('active'), 100);

            state.playerInput.push(index);

            const currentStep = state.playerInput.length - 1;
            
            if (state.playerInput[currentStep] !== state.sequence[currentStep]) {
                gameOver(false);
                return;
            }

            if (state.playerInput.length === state.sequence.length) {
                stopTimer(); 
                state.isPlayerTurn = false;
                statusText.innerText = "VALIDE...";
                statusText.style.color = "#00ff00";
                
                if (state.currentRound >= config.roundsToWin) {
                    setTimeout(gameWin, 800);
                } else {
                    setTimeout(nextRound, 800);
                }
            }
        }

        function gameWin() {
            stopTimer();
            playTone(1200, 'sine', 0.5);
            overlayMsg.innerHTML = `
                <div class="msg-success">SYSTÈME PIRATÉ</div>
                <div style="font-size: 1rem; margin-top:20px; color:#fff;">ACCÈS ROOT OBTENU</div>
            `;
            overlay.classList.add('visible');
            
            setTimeout(() => {
                alert("REDIRECTION VERS LE DOSSIER SECRET...");
            }, 2000);
        }

        function gameOver(isTimeout) {
            stopTimer();
            state.isPlayerTurn = false;
            playTone(100, 'sawtooth', 0.8); 
            
            document.querySelectorAll('.pad-btn').forEach(b => b.classList.add('error'));
            
            const reason = isTimeout ? "TEMPS ÉCOULÉ" : "ERREUR SÉQUENCE";

            overlayMsg.innerHTML = `
                <div class="msg-fail">DÉTECTION D'INTRUSION</div>
                <div style="font-size: 1rem; margin-top:20px; color:#fff;">${reason}</div>
            `;
            overlay.classList.add('visible');

            setTimeout(() => {
                window.location.href = '/access-denied.html';
            }, 2000);
        }
    </script>
</body>
</html>