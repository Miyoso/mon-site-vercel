<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIGACORP // HELPDESK</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #050510;
            --chat-bg: #0f0f1a;
            --user-msg: #0055ff;
            --bot-msg: #222;
            --text-color: #aaccff;
            --accent: #00ccff;
            --alert: #ff3333;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            background: #000;
            border-bottom: 2px solid var(--accent);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Share Tech Mono', monospace;
        }

        h1 { margin: 0; font-size: 1.4rem; letter-spacing: 2px; color: #fff; }
        .status-dot {
            height: 10px; width: 10px; background-color: #00ff00;
            border-radius: 50%; display: inline-block; margin-right: 5px;
            box-shadow: 0 0 5px #00ff00;
        }

        #chat-container {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--chat-bg);
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .message.bot {
            align-self: flex-start;
            background-color: var(--bot-msg);
            border-left: 3px solid var(--accent);
            color: #ddd;
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--user-msg);
            color: #fff;
            border-right: 3px solid #fff;
        }

        .message .sender {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 3px;
            display: block;
            font-family: 'Share Tech Mono', monospace;
        }

        .typing {
            align-self: flex-start;
            color: #666;
            font-style: italic;
            font-size: 0.8rem;
            display: none;
            margin-left: 10px;
        }

        .input-area {
            background: #000;
            padding: 20px;
            display: flex;
            gap: 10px;
            border-top: 1px solid #333;
        }

        input[type="text"] {
            flex-grow: 1;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 12px;
            border-radius: 4px;
            font-family: inherit;
        }
        input:focus { outline: none; border-color: var(--accent); }

        button {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 0 25px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.2s;
        }
        button:hover { background: #fff; }

        .suspicion-container {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 200px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #333;
            padding: 10px;
            border-radius: 4px;
        }
        .bar-label { font-size: 0.8rem; color: var(--alert); font-family: 'Share Tech Mono'; }
        .bar-bg { height: 10px; background: #333; margin-top: 5px; }
        .bar-fill { height: 100%; width: 0%; background: var(--alert); transition: width 0.5s; }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100; visibility: hidden; opacity: 0;
            transition: opacity 0.5s; text-align: center;
        }
        #overlay.visible { visibility: visible; opacity: 1; }
        .win-text { color: #00ff00; font-size: 2rem; font-family: 'Share Tech Mono'; text-shadow: 0 0 20px #00ff00; }
        .lose-text { color: #ff3333; font-size: 2rem; font-family: 'Share Tech Mono'; text-shadow: 0 0 20px #ff3333; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center;">
            <img src="/assets/logo-sas.png" style="height:30px; margin-right:15px; filter:invert(1);">
            <h1>GIGACORP SUPPORT <span style="font-size:0.8rem; color:#666;">// TICKET #4921</span></h1>
        </div>
        <div>
            <span class="status-dot"></span> EN LIGNE
        </div>
    </header>

    <div class="suspicion-container">
        <div class="bar-label">DÉTECTION D'INTRUSION</div>
        <div class="bar-bg"><div class="bar-fill" id="suspicionBar"></div></div>
    </div>

    <div id="chat-container">
    </div>

    <div class="typing" id="typingIndicator">Dave est en train d'écrire...</div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Entrez votre message..." autocomplete="off">
        <button id="btnSend">ENVOYER</button>
    </div>

    <div id="overlay"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatBox = document.getElementById('chat-container');
            const input = document.getElementById('userInput');
            const sendBtn = document.getElementById('btnSend');
            const typing = document.getElementById('typingIndicator');
            const suspicionBar = document.getElementById('suspicionBar');
            const overlay = document.getElementById('overlay');

            if (!chatBox || !input || !sendBtn) return;

            const botName = "Dave (IT Support)";
            let state = {
                step: 0,
                suspicion: 0,
                context: 'neutral'
            };

            function addMessage(text, sender) {
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                div.innerHTML = `<span class="sender">${sender === 'bot' ? botName : 'Moi'}</span>${text}`;
                chatBox.appendChild(div);
                setTimeout(() => {
                    chatBox.scrollTop = chatBox.scrollHeight;
                }, 50);
            }

            async function botReply(text, delay = 1500) {
                if (typing) {
                    typing.style.display = 'block';
                    chatBox.scrollTop = chatBox.scrollHeight;
                }
                
                await new Promise(r => setTimeout(r, delay));
                
                if (typing) typing.style.display = 'none';
                addMessage(text, 'bot');
            }

            function updateSuspicion(amount) {
                state.suspicion = Math.max(0, Math.min(100, state.suspicion + amount));
                if (suspicionBar) suspicionBar.style.width = state.suspicion + "%";

                if (state.suspicion >= 100) {
                    gameOver();
                }
            }

            function analyzeInput(text) {
                const lower = text.toLowerCase();
                let reply = "";

                if (state.step === 0) {
                    if (lower.includes("bonjour") || lower.includes("salut")) {
                        reply = "Bonjour. Support IT Gigacorp. J'ai vu votre ticket. C'est pour quoi ?";
                        state.step = 1;
                    } else if (lower.includes("mot de passe") || lower.includes("perdu")) {
                        reply = "Encore un oubli ? Pfff... Ok. C'est quoi votre identifiant employé ?";
                        state.step = 2;
                    } else {
                        reply = "Ici le Support. Je suis débordé, expliquez votre problème rapidement.";
                    }
                }
                else if (state.step === 1) {
                    if (lower.includes("mot de passe") || lower.includes("connexion")) {
                        reply = "D'accord. Procédure standard. Donnez-moi votre nom ou ID employé.";
                        state.step = 2;
                    } else {
                        reply = "Je ne comprends pas. C'est un problème réseau ou compte ?";
                        updateSuspicion(10);
                    }
                }
                else if (state.step === 2) {
                    if (lower.includes("henderson") || lower.includes("directeur")) {
                        reply = "Ah, Mr Henderson ? Désolé monsieur, je n'avais pas vu que c'était vous ! Je ne trouve pas votre numéro de badge dans le ticket.";
                        state.step = 3;
                        updateSuspicion(-20);
                    } 
                    else {
                        reply = `"${text}" ? Je ne trouve pas ce nom dans la base active. Vous êtes sûr de travailler à cet étage ?`;
                        updateSuspicion(25);
                    }
                }
                else if (state.step === 3) {
                    if (lower.includes("urgent") || lower.includes("maintenant") || lower.includes("vite") || lower.includes("réunion")) {
                        reply = "Ok, ok, ne vous énervez pas ! La procédure demande normalement une validation email... mais je peux faire une exception.";
                        state.step = 4;
                    } else {
                        reply = "Je vais devoir appeler votre superviseur pour confirmer l'identité. Procédure standard.";
                        updateSuspicion(20);
                    }
                }
                else if (state.step === 4) {
                    reply = "C'est bon. Mot de passe temporaire : <strong>GIGA_S3CR3T_2025</strong>. Changez-le vite.";
                    botReply(reply, 1000).then(gameWin);
                    return;
                }

                if (lower.includes("hacker") || lower.includes("police") || lower.includes("pirate")) {
                    reply = "Pardon ? C'est une blague ? Je signale ce chat à la sécurité.";
                    updateSuspicion(50);
                }

                botReply(reply);
            }

            function sendMessage() {
                const text = input.value.trim();
                if (!text) return;
                
                addMessage(text, 'user');
                input.value = '';
                analyzeInput(text);
            }

            function gameWin() {
                setTimeout(() => {
                    if(overlay) {
                        overlay.innerHTML = `
                            <div class="win-text">INGÉNIERIE SOCIALE RÉUSSIE</div>
                            <div style="color:#fff; margin-top:20px;">MOT DE PASSE ACQUIS</div>
                            <button onclick="window.location.href='/index.html'" style="margin-top:30px; cursor:pointer; padding:10px 20px;">RETOURNER AU QG</button>
                        `;
                        overlay.classList.add('visible');
                        localStorage.setItem('sas_social_hack', 'true');
                    }
                }, 3000);
            }

            function gameOver() {
                if(overlay) {
                    overlay.innerHTML = `
                        <div class="lose-text">CONNEXION TERMINÉE</div>
                        <div style="color:#fff; margin-top:20px;">L'ADMINISTRATEUR A BLOQUÉ VOTRE IP</div>
                        <button onclick="location.reload()" style="margin-top:30px; background:#ff3333; color:white; cursor:pointer; padding:10px 20px;">RÉESSAYER</button>
                    `;
                    overlay.classList.add('visible');
                }
            }

            sendBtn.addEventListener('click', sendMessage);

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            setTimeout(() => {
                botReply("Helpdesk Gigacorp, Dave à l'appareil. J'ai reçu une alerte sur ce compte. Identifiez-vous.");
            }, 800);
        });
    </script>
</body>
</html>